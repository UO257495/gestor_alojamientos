<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments/head :: head('Reserva')}"></th:block>
    <link rel="stylesheet" href="/css/reserva.css">
</head>
<body>
    <div th:replace="~{fragments/menu :: principal}"></div>

    <section class = "container contenido">
        
        <section class="container my-3">
            <div th:replace="~{fragments/mensajes :: mensajes-alerta (mensajeUsuario=${mensajeUsuario})}"></div>
        <!-- Formulario -->
            <form th:action="@{/reservar/confirmar}" th:object="${reservaForm}" method="post" class="reserva-form mb-4">
                <input type="hidden" th:field="*{alojamientoId}">
                <input type="hidden" th:field="*{clienteId}">
                <input type="hidden" th:field="*{precioTotal}" id="precioTotalInput">

                <div class="mb-3 row align-items-end">
                    <!-- Fecha Inicio -->
                    <div class="col-md-6">
                        <label class="form-label">Fecha Inicio <span class="text-danger">*</span></label>
                        <div id="fechaInicioInput" class="input-group" data-td-target-input="nearest" data-td-target-toggle="nearest">
                            <input id="fechaInicio" name="fechaInicio" th:field="*{fechaInicio}" type="text" class="form-control" data-td-target="#fechaInicio" autocomplete="off"/>
                            <span class="input-group-text" data-td-target="#fechaInicio" data-td-toggle="datetimepicker">
                                <span class="fa-solid fa-calendar"></span>
                            </span>
                        </div>
                        <small th:if="${#fields.hasErrors('fechaInicio')}" th:errors="*{fechaInicio}" class="text-danger"></small>
                    </div>

                    <!-- Fecha Fin -->
                    <div class="col-md-6">
                        <label class="form-label">Fecha Fin <span class="text-danger">*</span></label>
                        <div id="fechaFinInput" class="input-group" data-td-target-input="nearest" data-td-target-toggle="nearest">
                            <input id="fechaFin" name="fechaFin" th:field="*{fechaFin}" type="text" class="form-control" data-td-target="#fechaFin" autocomplete="off"/>
                            <span class="input-group-text" data-td-target="#fechaFin" data-td-toggle="datetimepicker">
                                <span class="fa-solid fa-calendar"></span>
                            </span>
                        </div>
                        <small th:if="${#fields.hasErrors('fechaFin')}" th:errors="*{fechaFin}" class="text-danger"></small>
                    </div>
                </div>

                <!-- Forma de pago -->
                <div class="mb-3">
                    <label for="formaPagoSelect" class="form-label">Forma de pago <span class="text-danger">*</span></label>
                    <select th:field="*{formaPago}" id="formaPagoSelect" class="form-select" required>
                        <option th:value="${null}" th:text="'Seleccione una opción...'"></option>
                        <option value="ALOJAMIENTO">Pago en el alojamiento</option>
                        <option value="TRANSFERENCIA">Transferencia bancaria</option>
                    </select>
                    <small th:if="${#fields.hasErrors('formaPago')}" th:errors="*{formaPago}" class="text-danger"></small>
                </div>

                <section class="container my-3">
                    <div class="reserva-card">
                        <div class="reserva-imagen">
                            <img th:src="@{${alojamiento.foto}}" alt="Foto del alojamiento">
                        </div>
                        <div class="reserva-detalles">
                            <h2 th:text="${alojamiento.nombre}"></h2>
                            <p><strong>Cliente:</strong> <span th:text="${clienteNombre}"></span></p>
                            <p><strong>Capacidad:</strong> <span th:text="${alojamiento.capacidad}"></span> personas</p>

                            <!-- Fechas seleccionadas -->
                            <p><strong>Fechas seleccionadas:</strong>
                                <span id="fechaInicioCard" th:text="${#temporals.format(reservaForm.fechaInicio, 'dd/MM/yyyy')}"></span> - 
                                <span id="fechaFinCard" th:text="${#temporals.format(reservaForm.fechaFin, 'dd/MM/yyyy')}"></span>
                            </p>

                            <!-- Forma de pago seleccionada -->
                            <p><strong>Forma de pago:</strong> <span id="formaPagoCard" th:text="${reservaForm.formaPago} ?: '-'"></span></p>

                            <!-- Precio total -->
                            <p><strong>Precio total:</strong> <span id="precioTotalCard" class="precio"  th:text="${#numbers.formatDecimal(reservaForm.precioTotal,1,2)} + ' €'"></span></p>
                        
                            <button type="submit" class="btn btn-verde w-100">Solicitar Reserva</button>
                        </div>
                    </div>
                </section>

            </form>
        </section>
        
        

    </section>

    <div th:replace="~{fragments/menu :: pie}"></div>
    <th:block th:replace="~{fragments/scripts :: scripts}"></th:block>
    <script th:inline="javascript">
        const TARIFA_BASE = [[${alojamiento.tarifaBase}]];
    </script>
    <script type="module" th:src="@{/js/reserva.js}"></script>
</body>
</html>
